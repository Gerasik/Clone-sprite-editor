!function(t){var e={};function s(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=6)}([function(t,e,s){t.exports=function(t){function e(a){if(s[a])return s[a].exports;var n=s[a]={exports:{},id:a,loaded:!1};return t[a].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){var a,n,i={}.hasOwnProperty,r=[].indexOf||function(t){for(var e=0,s=this.length;e<s;e++)if(e in this&&this[e]===t)return e;return-1};a=s(1).EventEmitter,s(2),n=function(t){function e(t){var e,a,n;for(a in this.running=!1,this.options={},this.frames=[],this.groups=new Map,this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),s)n=s[a],null==(e=this.options)[a]&&(e[a]=n)}var s,a;return function(t,e){function s(){this.constructor=t}for(var a in e)i.call(e,a)&&(t[a]=e[a]);s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype}(e,t),s={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1},a={delay:500,copy:!1},e.prototype.setOption=function(t,e){if(this.options[t]=e,null!=this._canvas&&("width"===t||"height"===t))return this._canvas[t]=e},e.prototype.setOptions=function(t){var e,s,a;for(e in s=[],t)i.call(t,e)&&(a=t[e],s.push(this.setOption(e,a)));return s},e.prototype.addFrame=function(t,e){var s,n,i;for(i in null==e&&(e={}),(s={}).transparent=this.options.transparent,a)s[i]=e[i]||a[i];if(null==this.options.width&&this.setOption("width",t.width),null==this.options.height&&this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!==ImageData&&t instanceof ImageData)s.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?s.data=this.getContextData(t):s.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?s.data=this.getImageData(t):s.image=t}return(n=this.frames.length)>0&&s.data&&(this.groups.has(s.data)?this.groups.get(s.data).push(n):this.groups.set(s.data,[n])),this.frames.push(s)},e.prototype.render=function(){var t,e,s;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var t,e,s;for(s=[],t=0,e=this.frames.length;0<=e?t<e:t>e;0<=e?++t:--t)s.push(null);return s}.call(this),e=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(t=0,s=e;0<=s?t<s:t>s;0<=s?++t:--t)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)this.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var t,e,s;return t=Math.min(this.options.workers,this.frames.length),function(){s=[];for(var a=e=this.freeWorkers.length;e<=t?a<t:a>t;e<=t?a++:a--)s.push(a);return s}.apply(this).forEach(function(t){return function(e){var s;return t.log("spawning worker "+e),(s=new Worker(t.options.workerScript)).onmessage=function(e){return t.activeWorkers.splice(t.activeWorkers.indexOf(s),1),t.freeWorkers.push(s),t.frameFinished(e.data,!1)},t.freeWorkers.push(s)}}(this)),t},e.prototype.frameFinished=function(t,e){var s,a,n,i;if(this.finishedFrames++,e?(s=this.frames.indexOf(t),a=this.groups.get(t.data)[0],this.log("frame "+(s+1)+" is duplicate of "+a+" - "+this.activeWorkers.length+" active"),this.imageParts[s]={indexOfFirstInGroup:a}):(this.log("frame "+(t.index+1)+" finished - "+this.activeWorkers.length+" active"),this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t),!0===this.options.globalPalette&&!e&&(this.options.globalPalette=t.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(n=1,i=this.freeWorkers.length;1<=i?n<i:n>i;1<=i?++n:--n)this.renderNextFrame();return r.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){var t,e,s,a,n,i,r,o,l,c,h,d,m,u,p,g,f,v,y,C;for(f=this.imageParts,n=i=0,c=f.length;i<c;n=++i)(e=f[n]).indexOfFirstInGroup&&(this.imageParts[n]=this.imageParts[e.indexOfFirstInGroup]);for(l=0,v=this.imageParts,r=0,h=v.length;r<h;r++)e=v[r],l+=(e.data.length-1)*e.pageSize+e.cursor;for(l+=e.pageSize-e.cursor,this.log("rendering finished - filesize "+Math.round(l/1e3)+"kb"),t=new Uint8Array(l),p=0,y=this.imageParts,o=0,d=y.length;o<d;o++)for(e=y[o],C=e.data,s=u=0,m=C.length;u<m;s=++u)g=C[s],t.set(g,p),p+=s===e.data.length-1?e.cursor:e.pageSize;return a=new Blob([t],{type:"image/gif"}),this.emit("finished",a,t)},e.prototype.renderNextFrame=function(){var t,e,s,a;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return t=this.frames[this.nextFrame++],(e=this.frames.indexOf(t))>0&&this.groups.has(t.data)&&this.groups.get(t.data)[0]!==e?void setTimeout(function(e){return function(){return e.frameFinished(t,!0)}}(this),0):(a=this.freeWorkers.shift(),s=this.getTask(t),this.log("starting frame "+(s.index+1)+" of "+this.frames.length),this.activeWorkers.push(a),a.postMessage(s))},e.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(t){var e;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},e.prototype.getTask=function(t){var e,s;if(e=this.frames.indexOf(t),s={index:e,last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:!0},null!=t.data)s.data=t.data;else if(null!=t.context)s.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");s.data=this.getImageData(t.image)}return s},e.prototype.log=function(t){if(this.options.debug)return console.log(t)},e}(a),t.exports=n},function(t,e){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(t){return"function"==typeof t}function n(t){return"object"==typeof t&&null!==t}function i(t){return void 0===t}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(t){if(!function(t){return"number"==typeof t}(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},s.prototype.emit=function(t){var e,s,r,o,l,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(i(s=this._events[t]))return!1;if(a(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),s.apply(this,o)}else if(n(s))for(o=Array.prototype.slice.call(arguments,1),c=s.slice(),r=c.length,l=0;l<r;l++)c[l].apply(this,o);return!0},s.prototype.addListener=function(t,e){var r;if(!a(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,a(e.listener)?e.listener:e),this._events[t]?n(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,n(this._events[t])&&!this._events[t].warned&&(r=i(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){function s(){this.removeListener(t,s),n||(n=!0,e.apply(this,arguments))}if(!a(e))throw TypeError("listener must be a function");var n=!1;return s.listener=e,this.on(t,s),this},s.prototype.removeListener=function(t,e){var s,i,r,o;if(!a(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=this._events[t],r=s.length,i=-1,s===e||a(s.listener)&&s.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(n(s)){for(o=r;o-- >0;)if(s[o]===e||s[o].listener&&s[o].listener===e){i=o;break}if(i<0)return this;1===s.length?(s.length=0,delete this._events[t]):s.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},s.prototype.removeAllListeners=function(t){var e,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(a(s=this._events[t]))this.removeListener(t,s);else if(s)for(;s.length;)this.removeListener(t,s[s.length-1]);return delete this._events[t],this},s.prototype.listeners=function(t){return this._events&&this._events[t]?a(this._events[t])?[this._events[t]]:this._events[t].slice():[]},s.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(a(e))return 1;if(e)return e.length}return 0},s.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){var s,a,n,i,r;r=navigator.userAgent.toLowerCase(),i=navigator.platform.toLowerCase(),s=r.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],n="ie"===s[1]&&document.documentMode,(a={name:"version"===s[1]?s[3]:s[1],version:n||parseFloat("opera"===s[1]&&s[4]?s[4]:s[2]),platform:{name:r.match(/ip(?:ad|od|hone)/)?"ios":(r.match(/(?:webos|android)/)||i.match(/mac|win|linux/)||["other"])[0]}})[a.name]=!0,a[a.name+parseInt(a.version,10)]=!0,a.platform[a.platform.name]=!0,t.exports=a}])},function(t,e,s){t.exports=function(){return new Worker(s.p+"gif.worker.js")}},function(t,e,s){t.exports=s.p+"./img/main.png"},function(t,e,s){t.exports=s.p+"./img/img1.gif"},function(t,e,s){t.exports=s.p+"./img/img2.jpeg"},function(t,e,s){t.exports=s.p+"./img/img3.gif"},function(t,e,s){"use strict";s.r(e);var a=s(0),n=s.n(a);class i{constructor(t){this.className=t,this.block=null}render(){const t=document.createElement("header");t.classList.add(this.className),t.innerHTML=`<button class="${this.className}__menu-button"><div></div><div></div><div></div></button>\n                        <h1 class="${this.className}__title">Piskel Clone</h1>\n                        <button class="${this.className}__position"><div></div><div></div><div></div></button>`,document.body.appendChild(t),this.block=t}}class r{constructor(t){this.className=t,this.block=null}render(){const t=document.createElement("section");t.classList.add(this.className),document.body.appendChild(t),this.block=t}}class o{constructor(t,e){this.className=t,this.parentBlock=e,this.block=null}render(){const t=document.createElement("section"),e=document.createElement("div");return t.classList.add(this.className),e.classList.add(`${this.className}__bar`),[{name:"pen",icon:"f304;"},{name:"fill",icon:"f576"},{name:"eraser",icon:"f12d"},{name:"line",icon:"f304"},{name:"square-fill",icon:"f45c"},{name:"square",icon:"f0c8"},{name:"circle-fill",icon:"f111"},{name:"circle",icon:"f111"},{name:"light",icon:"f067"},{name:"dark",icon:"f068"},{name:"color-pick",icon:"f1fb"},{name:"rotate",icon:"f0e2"},{name:"move",icon:"f0b2"},{name:"mirror",icon:"f071"}].forEach(t=>o.addTool(t,e,this.className)),t.appendChild(e),this.parentBlock.appendChild(t),{tools:t,toolsBar:e}}static createInputColor(t,e){const s=document.createElement("input");return s.setAttribute("type","color"),s.setAttribute("id",t),s.setAttribute("name",t),s.setAttribute("value",e),s}static addTool(t,e,s){const a=document.createElement("button");a.setAttribute("title",t.name),a.classList.add(`${s}__item`),a.classList.add(`${s}__${t.name}`),a.innerHTML=`<span>&#x${t.icon}</span>`,e.appendChild(a)}static addcolorList(t,e){const s=document.createElement("div");s.classList.add("tools__color-list");for(let t=0;t<e.length;t+=1){if(0!==t){const t=document.createElement("span");t.innerHTML="&#xf362",s.appendChild(t)}s.appendChild(o.createInputColor(e[t].name,e[t].color))}return t.appendChild(s),s}static canvasSizeList(t){const e=document.createElement("div"),s=document.createElement("span");s.innerHTML="Canvas size:";const a=document.createElement("select"),n=document.createElement("option");n.innerHTML="32x32",n.setAttribute("selected","selected");const i=document.createElement("option");i.innerHTML="64x64";const r=document.createElement("option");return r.innerHTML="128x128",a.appendChild(n),a.appendChild(i),a.appendChild(r),e.appendChild(s),e.appendChild(a),t.appendChild(e),e}static cursorPosition(){const t=document.createElement("div"),e=document.createElement("div"),s=document.createElement("div");t.classList.add("cursorPositon"),e.innerHTML='<span>X position:</span><span id="x">0</span>',s.innerHTML='<span>Y position:</span><span id="y">0</span>',t.appendChild(e),t.appendChild(s),document.body.appendChild(t)}}class l{constructor(t,e,s){this.frames=[],this.className=t,this.parentBlock=e,this.block=null,this.current=null,this.size=s}render(){const t=document.createElement("section");t.classList.add(this.className),t.innerHTML=`<div class="${this.className}__add-frame">\n                              <span>&#xf067</span>\n                              <span>Add new frame</span>\n                           <div>`,this.parentBlock.appendChild(t),this.block=t,0===this.frames.length&&this.createFrame()}createFrame(t){const e=document.createElement("div"),s=document.createElement("canvas"),a=document.createElement("span"),n=document.createElement("span"),i=document.createElement("span"),r=document.createElement("span");return s.setAttribute("width",this.size.width),s.setAttribute("height",this.size.width),a.classList.add(`${this.className}__number`),n.classList.add(`${this.className}__remove`),i.classList.add(`${this.className}__copy`),r.classList.add(`${this.className}__move`),a.innerHTML=this.block.childElementCount,n.innerHTML="&#xf2ed",i.innerHTML="&#xf0c5",r.innerHTML="&#xf0b2",e.classList.add(`${this.className}__frame`),e.appendChild(a),e.appendChild(n),e.appendChild(i),e.appendChild(r),e.appendChild(s),e.setAttribute("draggable",!0),t?t.parentElement.insertBefore(e,t.nextSibling):this.block.insertBefore(e,this.block.lastChild),this.toggleCurrFrame(e),e}toggleCurrFrame(t){this.current&&this.current.classList.remove("frame-list__curr-frame"),t.classList.add(`${this.className}__curr-frame`),this.current=t}createCopyFrame(t){const e=this.createFrame(t),s=e.getElementsByTagName("canvas")[0],a=t.getElementsByTagName("canvas")[0],n=a.getContext("2d").getImageData(0,0,a.width,a.height);return s.getContext("2d").putImageData(n,0,0),this.toggleCurrFrame(e),e}updateCount(){const t=this.block.children;for(let e=1;e<t.length;e+=1){t[e-1].querySelector(".frame-list__number").innerHTML=e}}}class c{constructor(t,e,s){this.className=t,this.parentBlock=e,this.block=null,this.size=s}render(){const t=document.createElement("section"),e=document.createElement("canvas"),s=document.createElement("canvas");e.setAttribute("width",this.size.width),e.setAttribute("height",this.size.width),e.classList.add(`${this.className}__canvas-image`),e.classList.add("canvas-image"),s.setAttribute("width",this.size.width),s.setAttribute("height",this.size.width),s.classList.add(`${this.className}__canvas-prev`),s.classList.add("canvas-prev"),t.classList.add(this.className),t.appendChild(e),t.appendChild(s),this.parentBlock.appendChild(t),this.block=t}}class h{constructor(t,e,s){this.className=t,this.parentBlock=e,this.sizeCanvas=s}render(){const t=document.createElement("section");return t.classList.add(this.className),t.innerHTML=`<canvas class="${this.className}__player" width="${this.sizeCanvas.width}" height="${this.sizeCanvas.height}"></canvas>\n                                <span class="${this.className}__full-size">&#xf066</span>\n                                <span class="${this.className}__number">FPS: 12</span>\n                                <input class="${this.className}__frequency" type="range" min="1" max="24" value="12" step="1">`,this.parentBlock.appendChild(t),t}updateFPS(t){const e=t.target.value;t.target.previousElementSibling.innerText=`FPS: ${e}`,this.frequency=e}}class d{constructor(t,e){this.className=t,this.parentBlock=e}render(){const t=document.createElement("section");return t.classList.add(this.className),t.innerHTML=`<span>Export:</span>\n                              <button class="${this.className}__download-gif" title="download gif">to GIF</button>\n                              <button class="${this.className}__download-jpeg" title="download jpeg">to JPEG</button>`,this.parentBlock.appendChild(t),t}}class m{constructor(t,e,s,a){this.toolList=t,this.canvas=e,this.getFrames=s,this.currFunction=null,this.moveFunction=null,this.moveFunctionFalse=null,this.params=a,this.startPosition={x:0,y:0},this.funtionList={pen:this.draw}}addEvents(){document.addEventListener("keypress",t=>{switch(this.unsetMainCanvasEvent(),t.key){case"p":m.setClass(this.toolList,"pen"),this.setMainCanvasEvent(this.draw);break;case"e":m.setClass(this.toolList,"eraser"),this.setMainCanvasEvent(this.erase);break;case"l":m.setClass(this.toolList,"line"),this.setMainCanvasEvent(this.line,!1);break;case"s":m.setClass(this.toolList,"square"),this.setMainCanvasEvent(this.square,!1);break;case"d":m.setClass(this.toolList,"square-fill"),this.setMainCanvasEvent(this.squareFill,!1);break;case"v":m.setClass(this.toolList,"circle-fill"),this.setMainCanvasEvent(this.circleFill,!1);break;case"c":m.setClass(this.toolList,"circle"),this.setMainCanvasEvent(this.circle,!1);break;case"a":m.setClass(this.toolList,"color-pick"),this.setMainCanvasEvent(this.colorPick,!1);break;case"n":m.setClass(this.toolList,"dark"),this.setMainCanvasEvent(this.minus,!1);break;case"m":m.setClass(this.toolList,"light"),this.setMainCanvasEvent(this.plus,!1);break;case"f":m.setClass(this.toolList,"fill"),this.setMainCanvasEvent(this.fill,!1);break;case"r":m.setClass(this.toolList,"rotate"),this.setMainCanvasEvent(this.rotate,!1,!1);break;case"t":m.setClass(this.toolList,"move"),this.setMainCanvasEvent(this.move,!1);break;case"z":m.setClass(this.toolList,"mirror"),this.setMainCanvasEvent(this.mirror,!1,!1);break;default:this.unsetMainCanvasEvent()}}),this.toolList.addEventListener("click",t=>{if("tools__bar"!==t.target.className){let e=t.target;for(;"BUTTON"!==e.tagName;)e=e.parentElement;switch(e.parentElement.querySelector(".tools__active")&&e.parentElement.querySelector(".tools__active").classList.remove("tools__active"),e.classList.add("tools__active"),this.unsetMainCanvasEvent(),e.classList[1].split("__")[1]){case"pen":this.setMainCanvasEvent(this.draw);break;case"eraser":this.setMainCanvasEvent(this.erase);break;case"line":this.setMainCanvasEvent(this.line,!1);break;case"square":this.setMainCanvasEvent(this.square,!1);break;case"square-fill":this.setMainCanvasEvent(this.squareFill,!1);break;case"circle-fill":this.setMainCanvasEvent(this.circleFill,!1);break;case"circle":this.setMainCanvasEvent(this.circle,!1);break;case"color-pick":this.setMainCanvasEvent(this.colorPick,!1);break;case"dark":this.setMainCanvasEvent(this.minus,!1);break;case"light":this.setMainCanvasEvent(this.plus,!1);break;case"fill":this.setMainCanvasEvent(this.fill,!1,!1);break;case"rotate":this.setMainCanvasEvent(this.rotate,!1,!1);break;case"move":this.setMainCanvasEvent(this.move,!1);break;case"mirror":this.setMainCanvasEvent(this.mirror,!1,!1);break;default:this.unsetMainCanvasEvent()}}})}static setClass(t,e){t.parentElement.querySelector(".tools__active")&&t.parentElement.querySelector(".tools__active").classList.remove("tools__active"),t.parentElement.querySelector(`.tools__${e}`)&&t.parentElement.querySelector(`.tools__${e}`).classList.add("tools__active")}move(t){const{x:e,y:s}=m.getMousePos(t),{canvas:a,context:n}=this.copyToCurrFrame(),i=e-this.startPosition.x,r=s-this.startPosition.y,o=n.getImageData(0,0,a.width,a.width);n.clearRect(0,0,a.width,a.height),n.putImageData(o,i,r),this.copyToCurrFrame()}mirror(){const{canvas:t,context:e}=this.copyToCurrFrame(),s=e.getImageData(0,0,t.width,t.height),{data:a}=s,n=[];for(let e=0;e<t.width;e+=1)for(let s=t.width-1;s>-1;s-=1){const i=4*s+4*e*t.width;n.push(a[i]),n.push(a[i+1]),n.push(a[i+2]),n.push(a[i+3])}n.forEach((t,e)=>{a[e]=t}),e.putImageData(s,0,0),this.copyToCurrFrame()}rotate(){const{canvas:t,context:e}=this.copyToCurrFrame(),s=e.getImageData(0,0,t.width,t.height),{data:a}=s,n=[];for(let e=t.width-1;e>-1;e-=1)for(let s=0;s<t.width;s+=1){const i=4*e+4*s*t.width;n.push(a[i]),n.push(a[i+1]),n.push(a[i+2]),n.push(a[i+3])}n.forEach((t,e)=>{a[e]=t}),e.putImageData(s,0,0),this.copyToCurrFrame()}fill(t){const{x:e,y:s}=m.getMousePos(t),{canvas:a,context:n}=this.copyToCurrFrame(),i=n.getImageData(0,0,a.width,a.height),r=i.data;let o=e+a.width*s;const l={r:r[4*o],g:r[4*o+1],b:r[4*o+2]},c=[],h=[],d=[];for(o=m.toTopPixel(l,o,r,a.width);o<=r.length/4&&m.matchColor(l,o,r);){if(m.matchColor(l,o-1,r)){const t=m.toTopPixel(l,o-1,r,a.width);-1===h.indexOf(t)&&h.push(t)}if(m.matchColor(l,o+1,r)){const t=m.toTopPixel(l,o+1,r,a.width);-1===d.indexOf(t)&&d.push(t)}c.push(o),o+=a.width}for(;h.length;){let t=h.pop();const e=Math.floor(t/a.width)*a.width-1,s=(Math.floor(t/a.width)+1)*a.width-1;for(;t<=r.length/4&&m.matchColor(l,t,r);){if(m.matchColor(l,t-1,r)&&e<=t-1&&t-1<s){const e=m.toTopPixel(l,t-1,r,a.width);h.push(e)}c.push(t),t+=a.width}}for(;d.length;){let t=d.pop();const e=Math.floor(t/a.width)*a.width-1,s=(Math.floor(t/a.width)+1)*a.width-1;for(;t<=r.length/4&&m.matchColor(l,t,r);){if(m.matchColor(l,t+1,r)&&e<=t+1&&t+1<=s){const e=m.toTopPixel(l,t+1,r,a.width);-1===d.indexOf(e)&&d.push(e)}c.push(t),t+=a.width}}m.fillNewColor(n,i,c,this.params.mainColor.color)}static fillNewColor(t,e,s,a){const n=e.data;for(let t=0;t<s.length;t+=1)n[4*s[t]]=parseInt(a.slice(1,3),16),n[4*s[t]+1]=parseInt(a.slice(3,5),16),n[4*s[t]+2]=parseInt(a.slice(5,7),16),n[4*s[t]+3]=255;t.putImageData(e,0,0)}static toTopPixel(t,e,s,a){let n=e-a;for(;n>=0&&m.matchColor(t,n,s);)n-=a;return n+a}static matchColor(t,e,s){const a=s[4*e],n=s[4*e+1],i=s[4*e+2];return t.r===a&&t.g===n&&t.b===i}plus(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame(),n=a.getImageData(e,s,1,1);for(let t=0;t<n.data.length-1;t+=1)n.data[t]+16<256&&(n.data[t]+=16);a.putImageData(n,e,s)}minus(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame(),n=a.getImageData(e,s,1,1);for(let t=0;t<n.data.length-1;t+=1)n.data[t]-16>=0&&(n.data[t]-=16);a.putImageData(n,e,s)}colorPick(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame(),n=a.getImageData(e,s,1,1).data;let i="";0===n[3]?i="ffffffff":n.forEach(t=>{const e=Number(t).toString(16);1===e.length&&(i+="0"),i+=e}),this.params.mainColor.color=`#${i.slice(0,6)}`,document.getElementById("main-color").value=`#${i.slice(0,6)}`}circle(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame(),n=e-this.startPosition.x,i=s-this.startPosition.y,r=Math.floor(Math.sqrt(n**2+i**2));a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor="black",a.beginPath(),a.strokeStyle=this.params.mainColor.color,a.arc(this.startPosition.x,this.startPosition.y,r,0,2*Math.PI,!1),a.stroke(),this.copyToCurrFrame()}circleFill(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame(),n=e-this.startPosition.x,i=s-this.startPosition.y,r=Math.floor(Math.sqrt(n**2+i**2));a.beginPath(),a.strokeStyle=this.params.mainColor.color,a.fillStyle=this.params.mainColor.color,a.arc(this.startPosition.x,this.startPosition.y,r,0,2*Math.PI,!1),a.fill(),a.stroke(),this.copyToCurrFrame()}square(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame();a.lineWidth=1,a.strokeStyle=this.params.mainColor.color;const n=e-this.startPosition.x,i=s-this.startPosition.y;a.strokeRect(this.startPosition.x,this.startPosition.y,n+1,i+1),this.copyToCurrFrame()}squareFill(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame(),n=e-this.startPosition.x,i=s-this.startPosition.y;a.lineWidth=1,a.fillStyle=this.params.mainColor.color,a.fillRect(this.startPosition.x,this.startPosition.y,n+1,i+1),this.copyToCurrFrame()}line(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame();a.beginPath(),a.lineWidth=1,a.fillStyle=this.params.mainColor.color,a.strokeStyle=this.params.mainColor.color,a.moveTo(this.startPosition.x+.5,this.startPosition.y+.5),a.lineTo(e+.5,s+.5),a.stroke(),this.copyToCurrFrame()}erase(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame();a.clearRect(e,s,1,1)}draw(t){const{x:e,y:s}=m.getMousePos(t),{context:a}=this.copyToCurrFrame();a.fillStyle="#fefefe",a.fillStyle=this.params.mainColor.color,a.fillRect(e,s,1,1)}init(){this.setMainCanvasEvent(this.draw),this.canvas.block.querySelector(".canvas-prev").addEventListener("mousemove",t=>{const e=t.target.getContext("2d");e.clearRect(0,0,t.target.width,t.target.height);const{x:s,y:a}=m.getMousePos(t);e.fillStyle="#8885",e.fillRect(s,a,1,1),document.getElementById("x").innerHTML=s,document.getElementById("y").innerHTML=a,this.canvas.block.querySelector(".canvas-prev").addEventListener("mouseleave",()=>e.clearRect(0,0,t.target.width,t.target.height))})}setMainCanvasEvent(t,e=!0,s=!0){const a=t.bind(this),n=this.canvas.block.querySelector(".canvas-prev");this.currFunction=a,this.moveFunction=this.mouseDown.bind(this,t,n),e?n.addEventListener("mousedown",this.moveFunction):s&&(this.moveFunctionFalse=this.updateStartPos.bind(this),n.addEventListener("mousedown",this.moveFunctionFalse),n.addEventListener("mouseup",a)),n.addEventListener("click",a)}updateStartPos(t){const{x:e,y:s}=m.getMousePos(t);this.startPosition.x=e,this.startPosition.y=s}mouseDown(t,e,s){const{x:a,y:n}=m.getMousePos(s);this.startPosition.x=a,this.startPosition.y=n;const i=t.bind(this);this.moveFunctionFalse=t.bind(this),e.addEventListener("mousemove",i),e.addEventListener("mouseup",()=>{this.params.dataImage=this.getFrames(),e.removeEventListener("mousemove",i)}),e.addEventListener("mouseleave",()=>{this.params.dataImage=this.getFrames(),e.removeEventListener("mousemove",i)})}unsetMainCanvasEvent(){const t=this.canvas.block.querySelector(".canvas-prev");t.removeEventListener("mouseup",this.currFunction),t.removeEventListener("mousedown",this.moveFunctionFalse),t.removeEventListener("mousedown",this.moveFunction),t.removeEventListener("click",this.currFunction)}static getMousePos(t){return{x:Math.floor(t.offsetX/(t.target.clientWidth/t.target.width)),y:Math.floor(t.offsetY/(t.target.clientHeight/t.target.height))}}copyToCurrFrame(){const t=this.canvas.block.querySelector(".canvas-image"),e=t.getContext("2d"),s=e.getImageData(0,0,t.width,t.height);return document.querySelector(".frame-list__curr-frame").getElementsByTagName("canvas")[0].getContext("2d").putImageData(s,0,0),{canvas:t,context:e}}}var u=s(1),p=s.n(u);class g{constructor(t){this.className=t,this.count=0,this.frequency=12,this.size={width:32},this.params={dataImage:null,currentTool:"pen",mainColor:{name:"main-color",color:"#00ffff"},secondColor:{name:"second-color",color:"#ffff00"}}}start(){new i("page-header").render();const t=new r("container");t.render();const e=new o("tools",t.block),{tools:s,toolsBar:a}=e.render(),u=[{name:this.params.mainColor.name,color:this.params.mainColor.color},{name:this.params.secondColor.name,color:this.params.secondColor.color}],f=o.addcolorList(s,u);f.addEventListener("change",t=>{t.target.name===this.params.mainColor.name?this.params.mainColor.color=t.target.value:t.target.name===this.params.secondColor.name&&(this.params.secondColor.color=t.target.value)},!1),f.getElementsByTagName("span")[0].addEventListener("click",t=>{const e=t.target.parentNode.firstChild,s=t.target.parentNode.lastChild,a=this.params.mainColor.color;this.params.mainColor.color=this.params.secondColor.color,e.value=this.params.secondColor.color,s.value=a,this.params.secondColor.color=a}),o.canvasSizeList(s).addEventListener("change",t=>{const e=document.getElementsByTagName("canvas");for(let s=0;s<e.length;s+=1){const a=e[s].getContext("2d"),n=t.target.value.split("x")[0],i=a.getImageData(0,0,e[s].width,e[s].height);e[s].setAttribute("width",n),e[s].setAttribute("height",n),a.putImageData(i,0,0),this.size.width=n}}),o.cursorPosition();const v=new l("frame-list",t.block,this.size);v.render();const y=new c("main-canvas",t.block,this.size);y.render();const C=new m(a,y,g.getFramesData,this.params);C.init(),C.addEvents(),v.block.addEventListener("click",g.eventFrameList.bind(v,this)),g.addDragEvent(v.block.firstChild,this);const b=new h("animation-player",t.block,{width:this.size.width,height:this.size.width}),_=b.render();_.addEventListener("input",b.updateFPS.bind(this)),_.addEventListener("click",t=>{"full-size"===t.target.className.split("__")[1]&&_.requestFullscreen()}),this.params.dataImage=g.getFramesData();const w=()=>{const t=this.params.dataImage,e=t[this.count%t.length];_.getElementsByTagName("canvas")[0].getContext("2d").putImageData(e,0,0),this.count+=1,setTimeout(w,1e3/this.frequency),this.params.dataImage=g.getFramesData()};setTimeout(w,1e3/this.frequency);const E=new d("download-menu",_).render();E.querySelector(".download-menu__download-gif").addEventListener("click",()=>{if(new p.a){const t=new n.a({workerScript:"gif.worker.js",workers:7,quality:10,width:this.size.width,height:this.size.width}),e=this.frequency;this.params.dataImage.forEach(s=>{const a=s;for(let t=3;t<a.data.length;t+=4)0===s.data[t]&&(a.data[t-1]=255,a.data[t-2]=255,a.data[t-3]=255,a.data[t]=255);t.addFrame(a,{delay:1e3/e})}),t.on("finished",t=>{const e=document.createElement("a"),s=URL.createObjectURL(t);e.setAttribute("href",s),e.setAttribute("download","download"),document.body.appendChild(e),e.click()}),t.render()}}),E.querySelector(".download-menu__download-jpeg").addEventListener("click",()=>{const t=document.querySelector(".main-canvas__canvas-image"),e=t.getContext("2d"),s=e.getImageData(0,0,t.width,t.width);for(let t=3;t<s.data.length;t+=4)0===s.data[t]&&(s.data[t-1]=255,s.data[t-2]=255,s.data[t-3]=255,s.data[t]=255);e.putImageData(s,0,0);const a=t.toDataURL("image/jpeg"),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download","download"),n.click()})}static eventFrameList(t,e){if("SECTION"!==e.target.tagName){let s=e.target;for(;"DIV"!==s.tagName;)s=s.parentElement;if("add-frame"===s.className.split("__")[1]){const e=this.createFrame();g.addDragEvent(e,t);const s=document.querySelector(".frame-list__curr-frame").getElementsByTagName("canvas")[0],a=s.getContext("2d").getImageData(0,0,s.width,s.height);g.updateMainCanvas(a)}else if("frame"===s.classList[0].split("__")[1])if("copy"===e.target.className.split("__")[1]){const e=this.createCopyFrame(s);g.addDragEvent(e,t);const a=s.getElementsByTagName("canvas")[0],n=a.getContext("2d").getImageData(0,0,a.width,a.height);g.updateMainCanvas(n),this.updateCount()}else if("remove"===e.target.className.split("__")[1]){let t;s.previousSibling?t=s.previousSibling:s.nextSibling&&"frame-list__add-frame"!==s.nextSibling.className?t=s.nextSibling:"frame-list__add-frame"===s.nextSibling.className&&(t=this.createFrame()),this.toggleCurrFrame(t);const e=t.getElementsByTagName("canvas")[0],a=e.getContext("2d").getImageData(0,0,e.width,e.height);g.updateMainCanvas(a),s.remove(),this.updateCount()}else{this.toggleCurrFrame(s);const t=s.getElementsByTagName("canvas")[0],e=t.getContext("2d").getImageData(0,0,t.width,t.height);g.updateMainCanvas(e)}}}static updateMainCanvas(t){document.querySelector(".canvas-image").getContext("2d").putImageData(t,0,0)}static getFramesData(t){const e=t||document.querySelector(".frame-list"),s=[];for(let t=0;t<e.children.length-1;t+=1){const a=e.children[t].getElementsByTagName("canvas")[0],n=a.getContext("2d");s.push(n.getImageData(0,0,a.width,a.height))}return s}updateFPS(t){const e=t.target.value;t.target.previousElementSibling.innerText=`FPS: ${e}`,this.frequency=e}static addDragEvent(t,e){t.addEventListener("dragstart",g.handleDragStart,!1),t.addEventListener("dragenter",g.handleDragEnter,!1),t.addEventListener("dragover",g.handleDragOver,!1),t.addEventListener("dragleave",g.handleDragLeave,!1),t.addEventListener("drop",g.handleDrop.bind(t,e),!1),t.addEventListener("dragend",g.handleDragEnd,!1)}static handleDragStart(t){this.style.opacity="0.4",t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("number",this.firstChild.innerHTML)}static handleDragEnter(){this.classList.add("over")}static handleDragLeave(){this.classList.remove("over")}static handleDragOver(t){t.preventDefault&&t.preventDefault()}static handleDrop(t,e){const s=t;e.stopPropagation&&e.stopPropagation();const a=e.dataTransfer.getData("number"),n=this.parentNode,i=n.children;let r;for(let t=0;t<i.length-1;t+=1)i[t].firstChild.innerHTML===a&&(r=i[t]);if(r){const t=n.removeChild(r);n.insertBefore(t,this)}return s.dataImage=g.getFramesData(),l.prototype.updateCount.call({block:n}),this.classList.remove("over"),!1}static handleDragEnd(){this.style.opacity="1"}}const f=s(2),v=s(3),y=s(4),C=s(5);class b{constructor(t){this.blockName=t}render(){const t=document.createElement("section");return t.classList.add(this.blockName),t.innerHTML=`<header class="${this.blockName}__header"><h1>${this.blockName}</h1></header>\n                      <section class="${this.blockName}__about-app">\n                      <p>\n                        <span>This is a free online editor for animated sprites & pixel art</span>\n                        <button id="startApp">Create sprite</button>\n                      </p>\n                      <img class="${this.blockName}__main-img" src="${f}"></section>\n                      <section class="${this.blockName}__examples">\n                        <span>EXAMPLE SPRITES</span>\n                        <img class="${this.blockName}__example-img" src="${v}"/>\n                        <img class="${this.blockName}__example-img" src="${y}"/>\n                        <img class="${this.blockName}__example-img" src="${C}"/>\n                      </section>\n                      <section class="${this.blockName}__functionality">\n                        <span>functionality</span>\n                        <ul>\n                          <li>\n                            <span>\n                              Live preview\n                            </span>\n                            <p>\n                              Check a preview of your animation in real time as you draw.\n                            </p>\n                          </li>\n                          <li>\n                            <span>\n                              Export to GIF\n                            </span>\n                            <p>\n                              Export your animated sprite to file system in .gif format\n                            </p>\n                          </li>\n                          <li>\n                            <span>\n                              Export to JPEG\n                            </span>\n                            <p>\n                              Export your animated sprite to file system in .jpeg format\n                            </p>\n                          </li>\n                          <li>\n                            <span>\n                              A lot of diffrent tools\n                            </span>\n                            <p>\n                              The editor has some diffrent tools\n                            </p>\n                          </li>\n                        </ul>\n                      </section>\n                      <section class="${this.blockName}__about-me">\n                        <h4>CONTACTS</h4>\n                        <span>App developed by Yauheni Herasimenka</span>\n                        <ul>\n                          <li><a href="https://t.me/gerasiks">&#xf2c6</a></li>\n                          <li><a href="https://github.com/Gerasik">&#xf092</a></li>\n                          <li><a href="mailto:gerasik1992@gmail.com">&#xf0e0</a></li>\n                        </ul>\n                      </section>`,document.body.appendChild(t),t}}s(7);(new class{constructor(){this.name="piskel-clone"}start(){const t=new b(this.name).render();document.getElementById("startApp").addEventListener("click",()=>{t.remove(t),new g("Piskel").start()})}}).start()},function(t,e){}]);
//# sourceMappingURL=bundle.js.map